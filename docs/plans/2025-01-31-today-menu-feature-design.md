# 今日菜单功能设计

## 概述

为"今天吃啥"应用添加"今日菜单"功能，允许用户：
1. 从菜品列表中选择多道菜加入今日菜单
2. 手动添加自选菜品（不在数据库中的菜）
3. 一键将菜单发送到指定邮箱

## 整体架构

### 新增组件
- `MenuFloat.vue` — 底部悬浮框组件
- `CustomDishModal.vue` — 自选菜品输入弹窗

### 新增 Store
- `src/stores/menu.ts` — 管理今日菜单状态

### 新增 API
- `api/send-menu.ts` — Vercel Serverless Function，调用 Resend 发送邮件

### 环境变量新增
```
RESEND_API_KEY=re_xxxxxxxx
RECIPIENT_EMAIL=your@email.com
```

### 数据结构
```typescript
interface MenuItem {
  id: string
  name: string
  isCustom: boolean  // 区分数据库菜品和自选菜品
}
```

## RecipeCard 改造

### 当前状态
点击整个卡片跳转 Notion，右侧一个箭头图标

### 改造后
- 点击卡片主体（菜名和标签区域）→ 跳转 Notion 页面
- 右侧改为两个按钮并排：
  - `→` 按钮：跳转 Notion（保留原功能）
  - `点菜` 按钮：加入今日菜单

### 交互细节
- 点击"点菜"后按钮短暂变成"已点"，0.5 秒后恢复
- 如果该菜已在菜单中，"点菜"按钮显示为灰色禁用状态

### 样式参考
```
┌─────────────────────────────────────┐
│ 红烧肉                       [→][点菜] │
│ 川菜 · 炖煮                          │
└─────────────────────────────────────┘
```

## 底部悬浮框 MenuFloat

### 布局结构
```
┌─────────────────────────────────────────┐
│ 今日菜单                        [自选]  │
├─────────────────────────────────────────┤
│ [红烧肉 ×] [西兰花 ×] [凉拌黄瓜 × ]     │
│                                         │
│             [ 一键下单 ]                 │
└─────────────────────────────────────────┘
```

### 状态说明
- **空状态：** 显示"还没点菜哦"提示文字，"一键下单"按钮禁用
- **有菜品：** 标签式显示，可横向换行，每个标签带 × 删除
- **自选菜品：** 用虚线边框或不同底色区分（比如浅黄色背景）

### 定位
悬浮框 fixed 在页面底部，菜品列表区域如果菜太多可以换行显示

## 自选菜品弹窗 CustomDishModal

### 触发
点击悬浮框右上角的"自选"按钮

### 弹窗内容
```
┌─────────────────────────┐
│     添加自选菜品     ×   │
├─────────────────────────┤
│  ┌─────────────────┐    │
│  │ 请输入菜名...    │    │
│  └─────────────────┘    │
│                         │
│   [取消]     [添加]     │
└─────────────────────────┘
```

### 交互
- 输入框自动聚焦
- 回车键 = 点击"添加"
- 添加成功后弹窗关闭，菜品出现在悬浮框
- 空输入时"添加"按钮禁用

### 样式
使用现有的模态框样式（参考 RandomResult 的 Teleport 方案），保持视觉一致性

## 邮件发送 API

### Serverless Function
`api/send-menu.ts`

### 请求格式
```typescript
POST /api/send-menu
{
  "dishes": [
    { "name": "红烧肉", "isCustom": false },
    { "name": "凉拌黄瓜", "isCustom": true }
  ]
}
```

### 邮件内容
```
主题：点菜啦（2025-01-31）

- 红烧肉
- 西兰花
- 凉拌黄瓜 (自选)
```

### 发送流程
1. 用户点击"一键下单"
2. 按钮变成 loading 状态
3. 调用 `/api/send-menu`
4. 成功：显示"下单成功！"提示，清空菜单
5. 失败：显示错误提示，保留菜单内容

### Resend 配置
- 发件人显示名："今天吃啥"
- 发件地址：需要在 Resend 验证域名，或用 `onboarding@resend.dev` 测试

## 文件变更清单

| 操作 | 文件 |
|------|------|
| 新增 | `src/components/MenuFloat.vue` |
| 新增 | `src/components/CustomDishModal.vue` |
| 新增 | `src/stores/menu.ts` |
| 新增 | `api/send-menu.ts` |
| 修改 | `src/components/RecipeCard.vue` |
| 修改 | `src/views/Home.vue` |

## 技术选型

- **邮件服务：** Resend（免费 3000 封/月）
- **状态管理：** Pinia（与现有架构一致）
- **弹窗方案：** Vue 3 Teleport（与 RandomResult 一致）
